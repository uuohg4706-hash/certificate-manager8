<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0}

body{
  font-family:'Cairo',sans-serif;
  background:#f0f2f5;
  padding:20px;
}

.container{
  max-width:1200px;
  margin:auto;
}

/* ===== Ù‡ÙŠØ¯Ø± ===== */
.header{
  background:#0b2a4a;
  color:#fff;
  padding:25px;
  border-radius:10px;
  margin-bottom:30px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
}

.header h1{
  font-size:1.8rem;
}

.logout-btn{
  background:#e74c3c;
  color:#fff;
  border:none;
  padding:10px 20px;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
  transition:background 0.3s;
}

.logout-btn:hover{
  background:#c0392b;
}

/* ===== Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© ===== */
.search-section{
  background:#fff;
  padding:25px;
  border-radius:10px;
  margin-bottom:30px;
  box-shadow:0 2px 8px rgba(0,0,0,0.1);
  display:flex;
  gap:15px;
  flex-wrap:wrap;
}

.search-input{
  flex:1;
  min-width:200px;
  padding:12px;
  border:2px solid #ddd;
  border-radius:6px;
  font-family:'Cairo',sans-serif;
  font-size:1rem;
  transition:border-color 0.3s;
}

.search-input:focus{
  outline:none;
  border-color:#0b2a4a;
  background:#fffacd;
}

.search-btn, .add-btn{
  padding:12px 30px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
  transition:all 0.3s;
  font-family:'Cairo',sans-serif;
  font-size:1rem;
}

.search-btn{
  background:#3498db;
  color:#fff;
}

.search-btn:hover{
  background:#2980b9;
}

.add-btn{
  background:#27ae60;
  color:#fff;
}

.add-btn:hover{
  background:#229954;
}

/* ===== Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª ===== */
.certificates-table{
  background:#fff;
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 2px 8px rgba(0,0,0,0.1);
  margin-bottom:30px;
}

.table-responsive{
  overflow-x:auto;
}

table{
  width:100%;
  border-collapse:collapse;
}

thead{
  background:#0b2a4a;
  color:#fff;
}

th{
  padding:15px;
  text-align:right;
  font-weight:700;
  border-bottom:2px solid #eee;
}

td{
  padding:15px;
  border-bottom:1px solid #eee;
}

tbody tr:hover{
  background:#f9f9f9;
}

.action-btns{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

.edit-btn, .delete-btn{
  padding:8px 15px;
  border:none;
  border-radius:4px;
  cursor:pointer;
  font-weight:600;
  font-size:0.9rem;
  transition:all 0.3s;
  font-family:'Cairo',sans-serif;
  text-decoration:none;
  display:inline-block;
}

.edit-btn{
  background:#3498db;
  color:#fff;
}

.edit-btn:hover{
  background:#2980b9;
}

.delete-btn{
  background:#e74c3c;
  color:#fff;
}

.delete-btn:hover{
  background:#c0392b;
}

/* ===== Ø§Ù„Ø±Ø³Ø§Ù„Ø§Øª ===== */
.empty-state{
  text-align:center;
  padding:60px 20px;
  color:#999;
}

.empty-state p{
  font-size:1.2rem;
  margin-bottom:20px;
}

.message{
  padding:15px;
  border-radius:6px;
  margin-bottom:20px;
  display:none;
}

.success{
  background:#d4edda;
  color:#155724;
  border:1px solid #c3e6cb;
}

.error{
  background:#f8d7da;
  color:#721c24;
  border:1px solid #f5c6cb;
}

/* ===== Modal ===== */
.modal{
  display:none;
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.5);
  z-index:1000;
  align-items:center;
  justify-content:center;
}

.modal.active{
  display:flex;
}

.modal-content{
  background:#fff;
  padding:30px;
  border-radius:10px;
  max-width:500px;
  width:90%;
  box-shadow:0 10px 40px rgba(0,0,0,0.3);
}

.modal-header{
  font-size:1.5rem;
  font-weight:700;
  margin-bottom:20px;
  color:#0b2a4a;
}

.form-group{
  margin-bottom:20px;
  text-align:right;
}

.form-group label{
  display:block;
  font-weight:600;
  color:#0b2a4a;
  margin-bottom:8px;
}

.form-group input{
  width:100%;
  padding:12px;
  border:2px solid #ddd;
  border-radius:6px;
  font-family:'Cairo',sans-serif;
  font-size:1rem;
  transition:border-color 0.3s;
}

.form-group input:focus{
  outline:none;
  border-color:#0b2a4a;
  background:#fffacd;
}

.modal-actions{
  display:flex;
  gap:10px;
  justify-content:flex-end;
  margin-top:30px;
}

.modal-btn{
  padding:12px 25px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
  font-family:'Cairo',sans-serif;
  font-size:1rem;
  transition:all 0.3s;
}

.save-btn{
  background:#27ae60;
  color:#fff;
}

.save-btn:hover{
  background:#229954;
}

.cancel-btn{
  background:#95a5a6;
  color:#fff;
}

.cancel-btn:hover{
  background:#7f8c8d;
}

.close-modal{
  float:left;
  font-size:1.5rem;
  cursor:pointer;
  color:#999;
}

.close-modal:hover{
  color:#333;
}
</style>
</head>

<body>

<div class="container">
  <!-- ===== Ù‡ÙŠØ¯Ø± ===== -->
  <div class="header">
    <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
    <button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>

  <!-- ===== Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ===== -->
  <div class="message success" id="successMsg"></div>
  <div class="message error" id="errorMsg"></div>

  <!-- ===== Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø¥Ø¶Ø§ÙØ© ===== -->
  <div class="search-section">
    <input 
      type="text" 
      class="search-input" 
      id="searchInput" 
      placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‚ÙŠØ¯ Ø£Ùˆ Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ÙØ¦Ø©..."
    >
    <button class="search-btn" onclick="searchCertificates()">Ø¨Ø­Ø«</button>
    <button class="add-btn" onclick="openAddModal()">+ Ø¥Ø¶Ø§ÙØ© Ø´Ù‡Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
  </div>

  <!-- ===== Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª ===== -->
  <div class="certificates-table">
    <div class="table-responsive">
      <table id="certificatesTable">
        <thead>
          <tr>
            <th>Ø±Ù‚Ù… Ø§Ù„Ù‚ÙŠØ¯</th>
            <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
            <th>Ø§Ù„ÙØ¦Ø©</th>
            <th>Ø§Ù„Ù…Ø±ÙƒØ²</th>
            <th>Ø§Ù„Ù…Ø¹Ø¯Ù„</th>
            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="tableBody">
        </tbody>
      </table>
    </div>
    <div class="empty-state" id="emptyState" style="display:none;">
      <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ù‡Ø§Ø¯Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</p>
      <button class="add-btn" onclick="openAddModal()">Ø¥Ø¶Ø§ÙØ© Ø´Ù‡Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    </div>
  </div>
</div>

<!-- ===== Modal Ø¥Ø¶Ø§ÙØ© Ø´Ù‡Ø§Ø¯Ø© ===== -->
<div class="modal" id="addModal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeAddModal()">&times;</span>
    <div class="modal-header">Ø¥Ø¶Ø§ÙØ© Ø´Ù‡Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>
    <form onsubmit="handleAddCertificate(event)">
      <div class="form-group">
        <label for="registrationNumber">Ø±Ù‚Ù… Ø§Ù„Ù‚ÙŠØ¯:</label>
        <input type="text" id="registrationNumber" required>
      </div>
      <div class="form-group">
        <label for="studentName">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
        <input type="text" id="studentName" required>
      </div>
      <div class="form-group">
        <label for="studentCategory">Ø§Ù„ÙØ¦Ø©:</label>
        <input type="text" id="studentCategory" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„ØµØºØ±Ù‰" required>
      </div>
      <div class="form-group">
        <label for="studentCenter">Ø§Ù„Ù…Ø±ÙƒØ²:</label>
        <input type="text" id="studentCenter" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø£ÙˆÙ„" required>
      </div>
      <div class="modal-actions">
        <button type="button" class="modal-btn cancel-btn" onclick="closeAddModal()">Ø¥Ù„ØºØ§Ø¡</button>
        <button type="submit" class="modal-btn save-btn">Ø¥Ø¶Ø§ÙØ© ÙˆØªØ­Ø±ÙŠØ±</button>
      </div>
    </form>
  </div>
</div>

<script>
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
window.addEventListener('load', ()=>{
  if(localStorage.getItem('teacherLoggedIn') !== 'true'){
    window.location.href = 'login.html';
    return;
  }
  
  // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¶Ø®Ù…Ø© Ù…Ù† localStorage ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
  cleanupLocalStorage();
  
  loadCertificates();
});

// Ø¯Ø§Ù„Ø© ØªÙ†Ø¸ÙŠÙ localStorage Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¶Ø®Ù…Ø©
function cleanupLocalStorage(){
  try {
    const stored = localStorage.getItem('certificates');
    if(stored) {
      let certs = JSON.parse(stored);
      let needsCleanup = false;
      
      // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¶Ø®Ù…Ø©
      certs = certs.map(c => {
        const cleaned = {...c};
        
        // Ø­Ø°Ù Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©
        if(cleaned.image) {
          delete cleaned.image;
          needsCleanup = true;
        }
        
        return cleaned;
      });
      
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø­Ø¬Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ¨ÙŠØ±Ø§Ù‹ Ø¬Ø¯Ø§Ù‹ØŒ Ø§Ø­ØªÙØ¸ Ø¨Ø¢Ø®Ø± 10 ÙÙ‚Ø·
      if(new Blob([JSON.stringify(certs)]).size > 1024 * 1024) { // > 1MB
        certs = certs.slice(-10);
        needsCleanup = true;
        console.log('âš ï¸ ØªÙ… ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¥Ù„Ù‰ Ø¢Ø®Ø± 10');
      }
      
      // Ø§Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸ÙŠÙØ©
      if(needsCleanup) {
        localStorage.setItem('certificates', JSON.stringify(certs));
        console.log('âœ… ØªÙ… ØªÙ†Ø¸ÙŠÙ localStorage Ø¨Ù†Ø¬Ø§Ø­');
      }
    }
  } catch(error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ†Ø¸ÙŠÙ:', error);
    // Ø¥Ø°Ø§ ÙØ´Ù„ - Ø§Ø­Ø°Ù ÙƒÙ„ Ø´ÙŠØ¡
    try {
      localStorage.removeItem('certificates');
      localStorage.removeItem('currentCertData');
      console.log('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø§Ù…ØªÙ„Ø§Ø¡');
    } catch(e) {}
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± + localStorage
async function loadCertificates(){
  try {
    let certs = [];
    
    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø£ÙˆÙ„Ø§Ù‹
    try {
      const response = await fetch('/api/certificates/list');
      if (response.ok) {
        const serverCerts = await response.json();
        console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${serverCerts.length} Ø´Ù‡Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±`);
        certs = serverCerts;
      }
    } catch (serverError) {
      console.warn('âš ï¸ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±ØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… localStorage', serverError);
      
      // Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ø³ÙŠØ±ÙØ±ØŒ Ø§Ø³ØªØ®Ø¯Ù… localStorage ÙƒØ¨Ø¯ÙŠÙ„
      const stored = localStorage.getItem('certificates');
      if (stored) {
        try {
          certs = JSON.parse(stored);
          if (!Array.isArray(certs)) {
            certs = [];
          }
        } catch (parseError) {
          console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª localStorage:', parseError);
          certs = [];
        }
      }
    }
    
    // Ø§Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø© ÙÙŠ localStorage Ù„Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„ÙŠÙ‡Ø§
    if (certs.length > 0) {
      localStorage.setItem('certificates', JSON.stringify(certs));
    }
    
    displayCertificates(certs);
    
  } catch (error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª:', error);
    displayCertificates([]);
  }
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª ÙÙŠ Ø¬Ø¯ÙˆÙ„
function displayCertificates(certs){
  const tableBody = document.getElementById('tableBody');
  const emptyState = document.getElementById('emptyState');
  
  if(certs.length === 0){
    tableBody.innerHTML = '';
    emptyState.style.display = 'block';
    return;
  }
  
  emptyState.style.display = 'none';
  tableBody.innerHTML = certs.map((cert) => `
    <tr>
      <td>${cert.registrationNumber || '-'}</td>
      <td>${cert.studentName}</td>
      <td>${cert.studentCategory}</td>
      <td>${cert.studentCenter}</td>
      <td>${cert.average || '-'}</td>
      <td>
        <div class="action-btns">
          <a href="editor.html?certId=${encodeURIComponent(cert.id)}" class="edit-btn">ØªØ­Ø±ÙŠØ±</a>
          <button class="delete-btn" data-cert-id="${cert.id}" onclick="deleteCertificateById(this)">Ø­Ø°Ù</button>
        </div>
      </td>
    </tr>
  `).join('');
}

// Ø§Ù„Ø¨Ø­Ø«
async function searchCertificates(){
  const query = document.getElementById('searchInput').value.toLowerCase();
  try {
    let certs = [];
    
    // Ø¬Ø±Ø¨ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø£ÙˆÙ„Ø§Ù‹
    try {
      const response = await fetch('/api/certificates/list');
      if (response.ok) {
        certs = await response.json();
      }
    } catch (e) {
      // Ø¥Ø°Ø§ ÙØ´Ù„ØŒ Ø§Ø³ØªØ®Ø¯Ù… localStorage
      const stored = localStorage.getItem('certificates');
      if (stored) {
        certs = JSON.parse(stored);
        if (!Array.isArray(certs)) {
          certs = [];
        }
      }
    }
    
    const filtered = certs.filter(c => 
      (c.registrationNumber && c.registrationNumber.toString().includes(query)) ||
      c.studentName.toLowerCase().includes(query) ||
      c.studentCategory.toLowerCase().includes(query) ||
      c.studentCenter.toLowerCase().includes(query)
    );
    displayCertificates(filtered);
  } catch (error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«:', error);
    showError('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«');
  }
}

// ÙØªØ­ modal Ø§Ù„Ø¥Ø¶Ø§ÙØ©
function openAddModal(){
  document.getElementById('addModal').classList.add('active');
}

// Ø¥ØºÙ„Ø§Ù‚ modal
function closeAddModal(){
  document.getElementById('addModal').classList.remove('active');
  document.getElementById('registrationNumber').value = '';
  document.getElementById('studentName').value = '';
  document.getElementById('studentCategory').value = '';
  document.getElementById('studentCenter').value = '';
}

// Ø¥Ø¶Ø§ÙØ© Ø´Ù‡Ø§Ø¯Ø©
function handleAddCertificate(e){
  e.preventDefault();
  
  const regNum = document.getElementById('registrationNumber').value.trim();
  const name = document.getElementById('studentName').value.trim();
  const category = document.getElementById('studentCategory').value.trim();
  const center = document.getElementById('studentCenter').value.trim();
  
  if(!regNum || !name || !category || !center){
    showError('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
    return;
  }
  
  try {
    let certs = [];
    const stored = localStorage.getItem('certificates');
    if (stored) {
      certs = JSON.parse(stored);
      if (!Array.isArray(certs)) {
        certs = [];
      }
    }
    
    const newCert = {
      id: Date.now().toString(), // Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯
      registrationNumber: regNum,
      studentName: name,
      studentCategory: category,
      studentCenter: center,
      sigName: 'Ø£. Ø´Ø±ÙˆÙ‚ Ø£Ø­Ù…Ø¯ ÙŠØ§Ø³ÙŠÙ†',
      attendance: 0,
      absence: 0,
      grades: [
        {subject: 'Ø§Ù„Ù‚Ø±Ø¢Ù†', first: 50, second: 50},
        {subject: 'Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©', first: 50, second: 50},
        {subject: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠ', first: 50, second: 50},
        {subject: 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª', first: 50, second: 50},
        {subject: 'Ø§Ù„Ø¹Ù„ÙˆÙ…', first: 50, second: 50},
        {subject: 'Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ', first: 50, second: 50},
        {subject: 'Ø§Ù„Ù†ÙˆØ±Ø§Ù†ÙŠÙ‡', first: 50, second: 50}
      ],
      average: 100,
      createdAt: new Date().toISOString()
    };
    
    certs.push(newCert);
    localStorage.setItem('certificates', JSON.stringify(certs));
    
    showSuccess('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ ÙØªØ­ Ø§Ù„Ù…Ø­Ø±Ø±...');
    closeAddModal();
    
    setTimeout(() => {
      // Store the certificate data to be loaded in editor
      localStorage.setItem('currentCertId', newCert.id);
      localStorage.setItem('currentCertData', JSON.stringify(newCert));
      window.location.href = 'editor.html?certId=' + newCert.id;
    }, 1000);
  } catch (error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©:', error);
    showError('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©');
  }
}

// Ø­Ø°Ù Ø´Ù‡Ø§Ø¯Ø©
function deleteCertificate(certId){
  if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©ØŸ')){
    try {
      console.log('Ø­Ø°Ù Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¨Ø±Ù‚Ù…:', certId);
      
      // Ø­Ø°Ù Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
      let certs = [];
      const stored = localStorage.getItem('certificates');
      
      if (stored) {
        try {
          certs = JSON.parse(stored);
        } catch (parseError) {
          console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„:', parseError);
          showError('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
          return;
        }
      }
      
      if (!Array.isArray(certs)) {
        certs = [];
      }
      
      console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø°Ù:', certs.length);
      console.log('Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª:', certs.map(c => c.id));
      
      const beforeLength = certs.length;
      const filteredCerts = certs.filter(c => {
        const isSame = c.id === certId;
        console.log(`Ù…Ù‚Ø§Ø±Ù†Ø©: "${c.id}" === "${certId}" => ${isSame}`);
        return !isSame;
      });
      
      const afterLength = filteredCerts.length;
      console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù:', afterLength);
      
      if(afterLength === beforeLength){
        showError('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ù„Ù„Ø­Ø°Ù!');
        return;
      }
      
      // Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
      localStorage.setItem('certificates', JSON.stringify(filteredCerts));
      console.log('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©');
      
      // Ø­Ø°Ù Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙˆØ± Ø£ÙŠØ¶Ø§Ù‹
      let withImages = [];
      const storedWithImages = localStorage.getItem('certificates_with_images');
      if(storedWithImages) {
        try {
          withImages = JSON.parse(storedWithImages);
          const filteredImages = withImages.filter(c => c.id !== certId);
          localStorage.setItem('certificates_with_images', JSON.stringify(filteredImages));
          console.log('ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©');
        } catch(e) {
          console.log('Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©:', e);
        }
      }
      
      // Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù†ÙØ³ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©
      const currentCertId = localStorage.getItem('currentCertId');
      if(currentCertId === certId) {
        localStorage.removeItem('currentCertId');
        localStorage.removeItem('currentCertData');
      }
      
      loadCertificates();
      showSuccess('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­');
    } catch (error) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©:', error);
      showError('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©');
    }
  }
}

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
function deleteCertificateById(buttonElement){
  const certId = buttonElement.getAttribute('data-cert-id');
  deleteCertificate(certId);
}

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
function logout(){
  if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')){
    localStorage.removeItem('teacherLoggedIn');
    localStorage.removeItem('loginTime');
    window.location.href = 'login.html';
  }
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
function showSuccess(msg){
  const el = document.getElementById('successMsg');
  el.textContent = msg;
  el.style.display = 'block';
  setTimeout(() => el.style.display = 'none', 3000);
}

function showError(msg){
  const el = document.getElementById('errorMsg');
  el.textContent = msg;
  el.style.display = 'block';
  setTimeout(() => el.style.display = 'none', 3000);
}

// Ø¥ØºÙ„Ø§Ù‚ Modal Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡
window.addEventListener('click', (e) => {
  const modal = document.getElementById('addModal');
  if(e.target === modal){
    closeAddModal();
  }
});
</script>

</body>
</html>
